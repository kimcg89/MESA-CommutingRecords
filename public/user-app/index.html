<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì¶œí‡´ê·¼ ê¸°ë¡ê¸°</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#1a73e8" />
    <!-- Firebase API ì„¤ì • íŒŒì¼ (ì¡°ê±´ë¶€ ë¡œë”©) -->
    <script>
      // ê°œë°œ/ë°°í¬ í™˜ê²½ì— ë”°ë¥¸ ì„¤ì • íŒŒì¼ ë¡œë”© (2025ë…„ 8ì›” 5ì¼ 20:45 ìˆ˜ì •ë¨)
      (function () {
        // ê°œë°œ í™˜ê²½ ê°ì§€ ë¡œì§ ê°œì„  (2025ë…„ 8ì›” 5ì¼ 20:45 ìˆ˜ì •ë¨)
        const isLocalhost =
          window.location.hostname === "localhost" ||
          window.location.hostname === "127.0.0.1";
        const isFirebaseServe = window.location.port === "5000";
        const isLiveServer =
          window.location.port === "5501" || window.location.port === "3000";

        // ê°œë°œ í™˜ê²½: Firebase serve ë˜ëŠ” Live Server
        const isDevelopment = isLocalhost && (isFirebaseServe || isLiveServer);

        const scriptSrc = isDevelopment
          ? "js/config/firebase-api-config.dev.js" // ê°œë°œìš©
          : "js/config/firebase-api-config.js"; // ë°°í¬ìš© (ë¹Œë“œ ì‹œ ìƒì„±)

        console.log("ğŸ”§ Firebase ì„¤ì • ë¡œë”©:", scriptSrc);
        console.log("ğŸ“ í™˜ê²½ ê°ì§€:", {
          hostname: window.location.hostname,
          port: window.location.port,
          isDevelopment: isDevelopment,
          isFirebaseServe: isFirebaseServe,
          isLiveServer: isLiveServer,
        });

        // ë™ê¸°ì‹ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ (2025ë…„ 8ì›” 5ì¼ 20:35 ìˆ˜ì •ë¨)
        document.write('<script src="' + scriptSrc + '"><\/script>');
      })();
    </script>
    <!-- ì „ì—­ë³€ìˆ˜ ì„¤ì • íŒŒì¼ -->
    <script src="js/constants/userData.js"></script>
    <script src="js/constants/holidays.js"></script>
    <!-- ì¤‘ë³µ ì œê±°: Firebase API ì„¤ì • íŒŒì¼ì€ ìœ„ì—ì„œ ì¡°ê±´ë¶€ë¡œ ë¡œë“œë¨ -->
    <!-- Firebase ì„¤ì • íŒŒì¼ -->
    <script src="js/config/firebase-config.js"></script>
    <!-- í•˜ì´ë¸Œë¦¬ë“œ Firebase API -->
    <script src="js/config/firebase-api.js"></script>
    <!-- ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ (2025ë…„ 8ì›” 6ì¼ ì¶”ê°€ë¨) -->
    <script>
      // ë„¤ì´ë²„ ì§€ë„ APIë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œ
      function loadNaverMapsAPI() {
        return new Promise((resolve, reject) => {
          if (typeof naver !== "undefined") {
            resolve();
            return;
          }

          const script = document.createElement("script");
          script.src =
            "https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=dfu49htc2u&submodules=geocoder";
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }

      // í˜ì´ì§€ ë¡œë“œ í›„ API ë¡œë“œ
      document.addEventListener("DOMContentLoaded", () => {
        loadNaverMapsAPI()
          .then(() => {
            console.log("ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì™„ë£Œ");
            // ì—¬ê¸°ì„œ attendance ì´ˆê¸°í™”
          })
          .catch((error) => {
            console.error("ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨:", error);
          });
      });
    </script>
    <!-- ë„¤ì´ë²„ API ì„¤ì • ë¡œë“œ -->
    <script src="./js/config/naver-api-config.js"></script>
    <!-- ì‹œê°„ ìœ í‹¸ë¦¬í‹° íŒŒì¼ -->
    <script src="js/utils/time-utils.js"></script>
    <!-- 1. í•µì‹¬ ëª¨ë‹¬ ì‹œìŠ¤í…œ -->
    <script src="js/ui/modals/core/modalCore.js"></script>
    <script src="js/ui/modals/core/modalUtils.js"></script>

    <!-- 2. ê¸°ë³¸ ëª¨ë‹¬ë“¤ -->
    <script src="js/ui/modals/notice/noticeModal.js"></script>
    <script src="js/ui/modals/attendance/attendanceModal.js"></script>

    <!-- 3. ê·¼ë¬´êµ¬ë¶„ ê´€ë ¨ ëª¨ë‹¬ë“¤ -->
    <script src="js/ui/modals/workType/workTypeModal.js"></script>
    <script src="js/ui/modals/workType/officeWorkModal.js"></script>
    <script src="js/ui/modals/workType/fieldWorkModal.js"></script>
    <script src="js/ui/modals/workType/remoteWorkModal.js"></script>

    <!-- 4. í†µí•© ì§„ì…ì  (ë§ˆì§€ë§‰) -->
    <script src="js/ui/modal.js"></script>
    <!-- ë‚ ì§œ/ì‹œê°„ UI íŒŒì¼ -->
    <script src="js/ui/datetime.js"></script>
    <!-- ì¸ì¦ ê´€ë¦¬ íŒŒì¼ -->
    <script src="js/auth/auth.js"></script>
    <!-- ì¶œê·¼/í‡´ê·¼ ë‚´ê·¼ì„¤ì • ìœ„ì¹˜ì •ë³´ íŒŒì¼ -->
    <script src="js/config/office-config.js"></script>
    <!-- ì¶œê·¼/í‡´ê·¼ ê´€ë¦¬ íŒŒì¼ - ëª¨ë“ˆí™” -->
    <script src="js/attendance/location-utils.js"></script>
    <script src="js/attendance/work-time-calculator.js"></script>
    <script src="js/attendance/attendance-core.js"></script>
    <script src="js/attendance/attendance-ui.js"></script>
    <!-- íœ´ê°€ ê´€ë¦¬ íŒŒì¼ -->
    <script src="js/leave/vacation-utils.js"></script>
    <script src="js/leave/vacation-ui.js"></script>
    <script src="js/leave/vacation-firestore.js"></script>
    <script src="js/leave/vacation-core.js"></script>

    <!-- ì”ëŸ‰ ê´€ë¦¬ íŒŒì¼ -->
    <script src="js/leave/leave-balance.js"></script>
    <!-- ì£¼ê°„ ìº˜ë¦°ë” íŒŒì¼ -->
    <script src="js/calendar/weekly-calendar.js"></script>
    <!-- ê·¼ë¬´ ê¸°ë¡ íŒŒì¼ -->
    <script src="js/history/work-history.js"></script>
    <!-- ë©”ëª¨ ê´€ë¦¬ íŒŒì¼ -->
    <script src="js/memo/memo.js"></script>
    <!-- ì•Œë¦¼ ê´€ë¦¬ íŒŒì¼ -->
    <script src="js/notification/alarm.js"></script>
    <!-- PWA ê´€ë¦¬ íŒŒì¼ -->
    <script src="js/pwa/pwa-handler.js"></script>

    <script type="module" src="script.js" defer></script>
  </head>
  <body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div
      id="loading-screen"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      "
    >
      <img
        src="./icons/icon-512x512.png"
        alt="App Icon"
        style="width: 220px; height: 220px"
      />
    </div>

    <div class="container">
      <div class="header">
        <div class="menu">
          <i class="fa-solid fa-bars"></i>
        </div>
        <div class="logo">
          <img src="./image/MESA-logo-white.png" alt="" />
        </div>
        <div class="homebtn">
          <i class="fa-solid fa-house"></i>
        </div>
      </div>

      <div class="bottom">
        <div class="button" id="applyVacation">
          <img src="./image/Airplane Square.png" alt="" />
          <p>ì—°ì°¨ì‹ ì²­</p>
        </div>
        <div class="button">
          <img src="./image/Edit.png" alt="" />
          <p>ì—°ì¥ê·¼ë¬´ì‹ ì²­(X)</p>
        </div>
        <div class="button">
          <img src="./image/Note Favorite.png" alt="" />
          <p>ê·¼ë¬´í˜„í™©(X)</p>
        </div>
      </div>

      <div class="home">
        <div class="recordBtnContainer">
          <div class="header-content">
            <h2>ì¶œí‡´ê·¼ ë“±ë¡</h2>
            <div class="info-btnContainer">
              <div class="annualLeave" id="annualLeave">
                <p>ì”ì—¬ ì—°ì°¨ ìˆ˜</p>
                <p>15ì¼</p>
              </div>
              <div class="compensatoryLeave" id="compensatoryLeave">
                <p>ë³´ìœ  ë³´ìƒíœ´ê°€</p>
                <p>0 ì‹œê°„</p>
              </div>
            </div>
          </div>
          <div class="headerTime">
            <p id="current-date"></p>
            <p id="current-time"></p>
          </div>
          <div class="recordBtns">
            <div class="startBtn" id="startBtn">ì¶œê·¼</div>
            <div class="endBtn" id="endBtn">í‡´ê·¼</div>
          </div>
        </div>
        <div class="workVacBtns">
          <div class="workRecordBtn" id="workRecordBtn">ê·¼ë¬´ ì´ë ¥ ë‚¨ê¸°ê¸°</div>
          <div class="vacationBtn" id="vacationBtn">ë³´ìƒíœ´ê°€ ì‹ ì²­</div>
        </div>
        <div class="workHistoryContainer">
          <div class="history-header">
            <h2>ê·¼ë¬´ ì •ë³´</h2>
            <span class="selected-date-display" id="selectedDateDisplay"
              >ì˜¤ëŠ˜</span
            >
          </div>
          <div class="history">
            <div class="historyList" id="historyList"></div>
          </div>
        </div>
        <div class="workTimeTableContainer">
          <div class="workDuration">
            <div><i class="fa-solid fa-caret-left"></i></div>
            <div>2025.01.20 ~ 2025.01.26</div>
            <div><i class="fa-solid fa-caret-right"></i></div>
          </div>
          <div class="monthlyCalendar">
            <i class="fa-solid fa-calendar-days"></i>
            <p>ì›”ê°„ê·¼ë¬´ë‚´ì—­(X)</p>
          </div>
          <div class="weeklyTable">
            <div class="day sunday">
              <span class="date">4</span>
              <span class="weekday">ì¼</span>
              <span class="time">-<br />-</span>
              <span class="duration">-</span>
              <span class="status">-</span>
              <span class="vacation-Info">-</span>
            </div>
            <div class="day">
              <span class="date">5</span>
              <span class="weekday">ì›”</span>
              <span class="time">09:05<br />-</span>
              <span class="duration">-</span>
              <span class="status">-</span>
              <span class="vacation-Info">-</span>
            </div>
            <div class="day">
              <span class="date">6</span>
              <span class="weekday">í™”</span>
              <span class="time">-<br />-</span>
              <span class="duration">-</span>
              <span class="status">-</span>
              <span class="vacation-Info">-</span>
            </div>
            <div class="day">
              <span class="date">7</span>
              <span class="weekday">ìˆ˜</span>
              <span class="time">-<br />-</span>
              <span class="duration">-</span>
              <span class="status">-</span>
              <span class="vacation-Info">-</span>
            </div>
            <div class="day">
              <span class="date">8</span>
              <span class="weekday">ëª©</span>
              <span class="time">-<br />-</span>
              <span class="duration">-</span>
              <span class="status">-</span>
              <span class="vacation-Info">-</span>
            </div>
            <div class="day">
              <span class="date">9</span>
              <span class="weekday">ê¸ˆ</span>
              <span class="time">-<br />-</span>
              <span class="duration">-</span>
              <span class="status">ë³´íœ´</span>
              <span class="vacation-Info">-</span>
            </div>
            <div class="day saturday">
              <span class="date">10</span>
              <span class="weekday">í† </span>
              <span class="time">-<br />-</span>
              <span class="duration">-</span>
              <span class="status">-</span>
              <span class="vacation-Info">-</span>
            </div>
          </div>
          <div class="workProgressBar">
            <div class="completed"></div>
            <div class="remaining"></div>
            <div class="standardLine"></div>
          </div>
          <div class="hours">
            <div class="workTime">37ì‹œê°„</div>
            <div class="standardTime">35</div>
            <div class="maxTime">52</div>
          </div>
        </div>
        <div class="worksMemoContainer" style="display: none">
          <h2>ê·¼ë¬´ MEMO</h2>
          <select class="projectSelectBox" id="projectSelectBox">
            <option value="" disabled selected>ì‚¬ì—…ëª… (PJT) : ì—†ìŒ</option>
            <option value="projectSelect1">í”„ë¡œì íŠ¸ 1</option>
            <option value="projectSelect2">í”„ë¡œì íŠ¸ 2</option>
          </select>
          <div class="workKind-DateBox">
            <select class="workSelectBox" id="workSelectBox">
              <option value="" disabled selected>ì—…ë¬´êµ¬ë¶„</option>
              <option value="workSelect1">ì¬íƒ</option>
              <option value="workSelect2">ë‚´ê·¼</option>
              <option value="workSelect3">ì™¸ê·¼</option>
            </select>
            <select class="workDateBox" id="workDateBox">
              <option value="" disabled selected>ë‚ ì§œ</option>
            </select>
          </div>
          <div class="workNote">
            <span>ìƒì„¸ë‚´ìš©</span>
            <textarea id="details" placeholder=""></textarea>
          </div>
          <div class="memoBtn">
            <button class="save-update" id="save-update">ì‘ì„±/ìˆ˜ì •</button>
            <button class="delete" id="delete">ì·¨ì†Œ</button>
          </div>
        </div>

        <main style="display: none">
          <div class="buttons">
            <button id="attendance-button">ì¶œê·¼</button>
            <div class="alarm">
              <div class="alarmTime">
                <div class="alarmTimeIcone">
                  <i class="fa-solid fa-bell"></i>
                  <p>ì•ŒëŒ</p>
                </div>
                <button id="alarm-button">On</button>
              </div>
            </div>
          </div>
          <div class="buttons"></div>
          <div class="records">
            <h2>GPS ê¸°ë¡ ë‚´ì—­</h2>
            <ul id="gps-record-list"></ul>
          </div>
          <div class="records">
            <h2>ê¸°ë¡ ë‚´ì—­</h2>
            <ul id="record-list"></ul>
          </div>

          <div class="calendar">
            <div class="calendar-header">
              <button id="prev-month"><<</button>
              <span id="current-month"></span>
              <button id="next-month">>></button>
            </div>
            <div id="calendar-container"></div>
          </div>
        </main>
      </div>

      <div class="calendarPageContainer" style="display: none">
        <div class="info-btnContainer">
          <div class="annualLeave">
            <p>ì”ì—¬ ì—°ì°¨ ìˆ˜</p>
            <p>13.5ì¼</p>
          </div>
          <div class="compensatoryLeave">
            <p>ë³´ìœ  ë³´ìƒíœ´ê°€</p>
            <p>200 ì‹œê°„</p>
          </div>
          <div class="approvalBtn">ê²°ì¬ìƒì‹ </div>
        </div>
        <div class="calendarContainer">
          <div class="monthlyProgressContainer"></div>
          <div class="calendar-date"></div>
          <div class="calendar"></div>
        </div>
        <div class="calendarWorkInfo">
          <div class="workDate"></div>
          <div class="startTime"></div>
          <div class="endTime"></div>
          <div class="vacTime"></div>
        </div>
      </div>

      <div class="modal-overlay" id="modal-overlay"></div>
      <div class="modal" id="vacation-modal">
        <h3>ë³´ìƒ íœ´ê°€ ì‹ ì²­</h3>
        <div
          id="selected-date-display"
          style="margin-bottom: 15px; font-weight: bold"
        ></div>
        <div>
          <label>ì‹œì‘ ì‹œê°„:</label>
          <select id="vacation-start-ampm">
            <option value="AM">ì˜¤ì „</option>
            <option value="PM">ì˜¤í›„</option>
          </select>
          <select id="vacation-start-hour"></select>
          <select id="vacation-start-minute">
            <option value="00">00ë¶„</option>
            <option value="30">30ë¶„</option>
          </select>
        </div>

        <div>
          <label>ì¢…ë£Œ ì‹œê°„:</label>
          <select id="vacation-end-ampm">
            <option value="AM">ì˜¤ì „</option>
            <option value="PM">ì˜¤í›„</option>
          </select>
          <select id="vacation-end-hour"></select>
          <select id="vacation-end-minute">
            <option value="00">00ë¶„</option>
            <option value="30">30ë¶„</option>
          </select>
        </div>
        <button id="save-vacation">ì €ì¥</button>
        <button id="cancel-vacation">ì·¨ì†Œ</button>
      </div>

      <div class="modal" id="attendance-modal">
        <button id="save-vacation">ì €ì¥</button>
        <button id="cancel-vacation">ì·¨ì†Œ</button>
      </div>
      <div class="modal" id="notice-modal">
        <div class="modal-content">
          <p id="notice-message"></p>
          <button id="close-notice">í™•ì¸</button>
        </div>
      </div>

      <div class="modal-overlay" id="modal-overlay-annual"></div>
      <div class="modal" id="annual-vacation-modal">
        <h3>ì—°ì°¨ íœ´ê°€ ì‹ ì²­</h3>
        <div>
          <label>ì‹œì‘ì¼:</label>
          <select id="start-month"></select>
          <select id="start-day"></select>
          <select id="start-type">
            <option value="full">ì¢…ì¼</option>
            <option value="morning">ì˜¤ì „</option>
            <option value="afternoon">ì˜¤í›„</option>
          </select>
        </div>
        <div>
          <label>ì¢…ë£Œì¼:</label>
          <select id="end-month"></select>
          <select id="end-day"></select>
          <select id="end-type">
            <option value="full">ì¢…ì¼</option>
            <option value="morning">ì˜¤ì „</option>
            <option value="afternoon">ì˜¤í›„</option>
          </select>
        </div>

        <button id="save-annual-vacation">ì €ì¥</button>
        <button id="cancel-annual-vacation">ì·¨ì†Œ</button>
      </div>

      <div class="modal-overlay" id="gps-loading-overlay" style="display: none">
        <div class="modal" id="gps-loading-modal">
          <p id="gps-loading-message">ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    </div>

    <div class="loginSectionContainer">
      <div class="login-container">
        <div class="signin-section">
          <h2>Sign In</h2>
          <form id="login-form">
            <div class="input-group">
              <label for="username">UserEmail</label>
              <input
                type="text"
                id="username"
                name="username"
                placeholder="UserEmail@mesa.kr"
              />
            </div>
            <div class="input-group">
              <label for="password">Password</label>
              <input
                type="password"
                id="password"
                name="password"
                placeholder="Password"
              />
            </div>
            <button type="submit" class="sign-in-btn">Sign In</button>
            <div class="remember-forgot">
              <label
                ><input type="checkbox" id="rememberMe" /> Remember Me</label
              >
              <a href="#" class="forgot-password">Forgot Password</a>
            </div>
          </form>
        </div>
      </div>
    </div>
    <button id="installButton" style="display: none">ì•± ì„¤ì¹˜</button>

    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  </body>
</html>
